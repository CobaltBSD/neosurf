execute_process(COMMAND gperf ${CMAKE_SOURCE_DIR}/contrib/libsvgtiny/src/colors.gperf --output-file=${CMAKE_BINARY_DIR}/contrib/libsvgtiny/autogenerated_colors.c)

# Squash "error: no previous declaration for 'svgtiny_color_lookup'"
execute_process(COMMAND sed "s/^\\(const struct svgtiny_named_color\\)/static \\1/" -i ${CMAKE_BINARY_DIR}/contrib/libsvgtiny/autogenerated_colors.c)

add_library(svgtiny SHARED
	src/svgtiny.c
	src/svgtiny_gradient.c
	src/svgtiny_list.c
)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -W -Wundef -Wpointer-arith -Wcast-align -Wwrite-strings -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -D_BSD_SOURCE -D_DEFAULT_SOURCE -I${CMAKE_SOURCE_DIR}/contrib/libsvgtiny/include/ -I${CMAKE_SOURCE_DIR}/contrib/libsvgtiny/src -std=c99 -Werror -pedantic -I${CMAKE_SOURCE_DIR}/contrib/libdom/include -I${CMAKE_SOURCE_DIR}/contrib/libwapcaplet/include -Wno-unused-function -I${CMAKE_BINARY_DIR}/contrib/libsvgtiny -Wno-missing-prototypes")

target_link_libraries(svgtiny wapcaplet dom m)

install(TARGETS svgtiny DESTINATION ${CMAKE_INSTALL_PREFIX}/lib)
